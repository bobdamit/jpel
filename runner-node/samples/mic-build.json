{
	"id": "mic-build",
	"name": "Build steps and quality checks for microphone assembly",
	"description": "A process demonstrating build steps and quality checks for microphone assembly",
	"version": "1.0.0",
	"start": "a:main",
	"variables": [
		{
			"name": "title",
			"type": "text",
			"description": "Title generated from common facts"
		}
	],
	"activities": {


		"main": {
			"name": "Main",
			"description": "Main Sequence",
			"type": "sequence",
			"activities": [
				"a:basicFactsSequence",
				"a:validateCommonFacts",
				"a:micTypeDecision"
			]
		},


		"basicFactsSequence": {
			"name": "Collect Basic Facts",
			"description": "Gather essential information about the order and config",
			"type": "sequence",
			"activities": [
				"a:commonFacts",
				"a:generateTitle"
			]
		},
		"commonFacts": {
			"name": "Common Facts Collection",
			"description": "Collect common facts applicable to all microphone builds",
			"type": "human",
			"prompt": "Please provide the following common details for the microphone assembly:",
			"inputs": [
				{
					"name": "customerName",
					"type": "text",
					"label": "Customer Name",
					"required": true,
					"placeholder": "Enter customer name",
					"minLength": 3,
					"description": "The name of the customer"
				},
				{
					"name": "storeOrderNumber",
					"type": "text",
					"label": "Store Order Number",
					"required": true,
					"description": "The order number associated with the store"
				},
				{
					"name": "buildNumber",
					"type": "text",
					"label": "Build Number",
					"required": true,
					"description": "The unique identifier for the build",
					"pattern": "^\\d{4,6}$",
					"patternDescription": "Build number must be 4-6 digits"
				},
				{
					"name": "bodySource",
					"type": "select",
					"label": "Body Source",
					"required": true,
					"options": [
						"Donor",
						"RS Custom"
					],
					"description": "Source of this microphone body"
				},
				{
					"name": "microphoneCategory",
					"type": "select",
					"label": "Microphone Category",
					"required": true,
					"options": [
						"LDC",
						"SDC"
					],
					"description": "Category of the microphone"
				}
			]
		},


		"micTypeDecision": {
			"name": "Conditional for LDC/SDC",
			"type": "switch",
			"expression": "a:commonFacts.v:microphoneCategory",
			"cases": {
				"LDC": "a:ldcMic",
				"SDC": "a:sdcMic"
			}
		},
		"ldcMic": {
			"name": "LDC Mic Sequence",
			"description": "LDC Mic Sequence Branch",
			"type": "sequence",
			"activities": [
				"a:ldcDonorFacts",
				"a:ldcFacts"
			]
		},
		"sdcMic": {
			"name": "SDC Mic Sequence",
			"description": "SDC Mic Sequence Branch",
			"type": "sequence",
			"activities": []
		},

		"ldcDonorFacts" : {
			"name": "LDC Donor Facts",
			"description": "Collect Data Regarding LDC Donor Type",
			"type": "human",
			"inputs": [
				{
					"name": "donor",
					"type": "select",
					"label": "Donor",
					"required": true,
					"options": [
						"990",
						"990S",
						"770",
						"Nova",
						"ST55",
						"910",
						"920",
						"Other (800-ish)"
					]
				}
			]
		},

		"ldcFacts": {
			"name": "LDC Facts Sequence",
			"description": "LDC Facts Sequence Branch",
			"type": "sequence",
			"activities": [
			]
		},

		"ldcCapsuleFacts": {
			"name": "LDC Capsule Facts",
			"description": "Collect Data Regarding LDC Capsule Type",
			"type": "human",
			"inputs": [
				{
					"name": "capsule",
					"type": "select",
					"label": "Capsule",
					"required": true,
					"options": [
						"K47-Style (getwin)",
						"CK12-Style (getwin)"
					]
				}
			]
		},
		"transformerFacts": {
			"name": "Transformer Facts",
			"description": "Collect Data Regarding Transformer Type",
			"type": "human",
			"inputs": [
				{
					"name": "transformer",
					"type": "select",
					"label": "Transformer",
					"required": true,
					"options": [
						"Cinemag 5722w",
						"AMI T12",
						"3U Audio GZT-84",
						"Neutrik (lo-fi)",
						"Other"
					]
				}
			]
		},
		"validateCommonFacts": {
			"name": "Validate Common Facts",
			"description": "Ensure all common facts are correctly provided",
			"type": "compute",
			"code": [
				"// Retrieve common facts from the previous activity",
				"const buildNumber = a:commonFacts.v:buildNumber;",
				"// Check if build number exists and is valid",
				"a:validateCommonFacts.passFail = buildNumber ? 'pass' : 'fail';"
			]
		},

		"generateTitle": {
			"name": "Generate Title",
			"description": "Generate a title for the build based on common facts",
			"type": "compute",
			"code": [
				"// Retrieve common facts from the previous activity",
				"const customerName = a:commonFacts.v:customerName;",
				"const buildNumber = a:commonFacts.v:buildNumber;",
				"const microphoneCategory = a:commonFacts.v:microphoneCategory;",
				"const title = `${customerName}-${buildNumber}-${microphoneCategory}`;",
				"v:title = title;"
			]
		}
	}
}